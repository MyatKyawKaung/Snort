### **In this demo, I will generate & analyze **Alert Signatures** from PCAP files.**

## PCAP_01 (DARKGATE ACTIVITY)

Unzip the downloaded pcap.zip file from https://www.malware-traffic-analysis.net/

```
unzip -P infected_20240514 2024-05-14-DarkGate-infection-traffic.pcap.zip
```
![image01](https://github.com/user-attachments/assets/04cda474-a424-4bd6-8701-dfc15f2f4310)

**Run Snort3 using the unzipped pcap file to see the signatures generated from Snort**

```
snort -c /usr/local/snort/etc/snort/snort.lua --plugin-path /usr/local/etc/so_rules/ -r 2024-05-14-DarkGate-infection-traffic.pcap -A alert_fast -q
```

Command Breakdown:

`r <pcap filename>`

- `-r`: This option specifies the packet capture file to be analyzed.
- `2024-05-14-DarkGate-infection-traffic.pcap`: This is the name of the PCAP file.

`-A alert_fast -q`

- `-A`: This option sets the alert mode.
- `alert_fast`: This specifies that Snort generate alerts in a "brief text format" immediately upon detecting a threat. (More Information: https://docs.snort.org/start/alert_logging)
- `-q`: This option enables quiet mode, which suppresses most output to the console.

![image02](https://github.com/user-attachments/assets/e2918d05-6aae-4465-9b78-9a3cc31912f4)

**One signature "(stream_tcp) reset outside window" was generated by Snort in this pcap. (Which might require further investigation using Wireshark)**

## PCAP_02 (BB12 QAKBOT (QBOT) WITH COBALT STRIKE AND DARK CAT VNC)

Unzip the downloaded pcap.zip file from https://www.malware-traffic-analysis.net/2023-01-31-BB12-Qakbot-with-Cobalt-Strike-and-Dark-Cat-VNC-traffic.pcap.zip

```
unzip -P infected_20230131 2023-01-31-BB12-Qakbot-with-Cobalt-Strike-and-Dark-Cat-VNC-traffic.pcap.zip
```
![image03](https://github.com/user-attachments/assets/947220d0-481e-4da3-ad71-2b8ab699dbc1)

Run Snort3 using the unzipped pcap file to see the signatures generated from Snort

```
snort -c /usr/local/snort/etc/snort/snort.lua --plugin-path /usr/local/etc/so_rules/ -r 2023-01-31-BB12-Qakbot-with-Cobalt-Strike-and-Dark-Cat-VNC-traffic.pcap -A alert_fast -q
```
![image04](https://github.com/user-attachments/assets/f9bef7f6-0f33-4456-bde7-00e7f82c0e02)

**As you can see in the figure, there are many alert signatures detected by Snort. So we will have to make the logs into manageable size.**

**First, we will save the output into pcap2-signatures.txt**

```
snort -c /usr/local/snort/etc/snort/snort.lua --plugin-path /usr/local/etc/so_rules/ -r 2023-01-31-BB12-Qakbot-with-Cobalt-Strike-and-Dark-Cat-VNC-traffic.pcap -A alert_fast -q > pcap2-signatures.txt
```
![image05](https://github.com/user-attachments/assets/d70ed637-1776-4127-9466-375489bdc93b)

We will now utilize "cut" command to make the signatures more presentable

```
cat pcap2-signatures.txt | cut -d "[" -f 3 | cut -d '"' -f 2 | sort | uniq -c | sort -nr
```

Command Breakdown:

`cut -d "[" -f 3`:

- `cut`: This command is used to extract specific fields from a text file.
- `-d "["`: Specifies that the delimiter used to separate fields is the left square bracket (`[`).
- `-f 3`: Extracts the third field from each line. **This is where the signature name is located**.
- `uniq -c`: Counts the occurrences of each unique signature name and displays the count.
- `sort`: This command sorts the data that is piped to it.
- `-n`: This option tells `sort` to sort the data numerically, instead of alphabetically.
- `-r`: This option tells `sort` to sort in reverse order.

![image06](https://github.com/user-attachments/assets/b0b518a0-b21a-4f36-818b-1bcfb797d6f1)

We can see 3 unique alert signatures, but we might still want to know which IP addresses attempted **"Port Sweeping and Scanning"** activities.

```
grep -E "portscan | portsweep" pcap2-signatures.txt 
```
![image07](https://github.com/user-attachments/assets/3fe81bd1-d1a3-4c77-b3ed-c8644168f7b0)

**Now we get IP addresses from the alerts, save the output into file named "pcap2-furtherInvestigation.txt" for further investigation using Protocol Analyzer tools like Wireshark.**
